================================================================================
COMMANDES UTILES - SYST√àME LINXO AVEC VALIDATION CSV
================================================================================

üìÖ Date: 9 octobre 2025
‚úÖ Version: v2_FIXED + Validation stricte

================================================================================
üöÄ UTILISATION STANDARD
================================================================================

# Analyse du mois en cours avec envoi SMS/Email
cd /home/ubuntu/linxo_agent
python3 analyze_and_notify_v2_FIXED.py --period current_month

# Mode test (dry-run) - Analyse sans envoi
python3 analyze_and_notify_v2_FIXED.py --period current_month --dry-run

# Analyse uniquement (pas de notifications)
python3 analyze_and_notify_v2_FIXED.py --period current_month --no-notifications

# Analyse du mois pr√©c√©dent
python3 analyze_and_notify_v2_FIXED.py --period last_month

# Analyse des 30 derniers jours
python3 analyze_and_notify_v2_FIXED.py --period last_30_days

================================================================================
üß™ TESTS
================================================================================

# Tests automatis√©s complets
cd /home/ubuntu/linxo_agent
python3 test_validation_complete.py

# Script de test bash (validation + analyse + notifications)
./TEST_FINAL_VALIDATION.sh

# Test SMS OVH uniquement
python3 test_sms_ovh.py

================================================================================
üìÅ GESTION DES FICHIERS CSV
================================================================================

# V√©rifier le fichier CSV actuel
ls -lh /home/ubuntu/data/latest.csv
head -20 /home/ubuntu/data/latest.csv

# Copier un nouveau CSV depuis Downloads
cp ~/Downloads/linxo_export.csv /home/ubuntu/data/latest.csv

# Utiliser le CSV de test (octobre uniquement)
cp /home/ubuntu/data/latest_octobre_only.csv /home/ubuntu/data/latest.csv

# Restaurer le CSV historique complet (pour tests de rejet)
cp /home/ubuntu/data/latest_backup_full_history.csv /home/ubuntu/data/latest.csv

# Cr√©er un CSV filtr√© pour un mois sp√©cifique
head -1 /home/ubuntu/data/latest.csv > /home/ubuntu/data/latest_filtered.csv
awk -F'\t' 'NR>1 && $1 ~ /^(0[1-9]|[12][0-9]|3[01])\/10\/2025$/' /home/ubuntu/data/latest.csv >> /home/ubuntu/data/latest_filtered.csv

================================================================================
üìä CONSULTATION DES LOGS
================================================================================

# Voir le dernier log
tail -100 $(ls -t /home/ubuntu/logs/analyze_notify_*.log | head -1)

# Voir tous les logs r√©cents
ls -lt /home/ubuntu/logs/analyze_notify_*.log | head -10

# Rechercher les erreurs dans les logs
grep -i "error\|failed\|√©chou√©" $(ls -t /home/ubuntu/logs/analyze_notify_*.log | head -1)

# Voir les validations CSV dans les logs
grep -A 10 "VALIDATION DU CSV" $(ls -t /home/ubuntu/logs/analyze_notify_*.log | head -1)

# Voir les r√©sultats d'analyse
grep -A 20 "R√âSULTATS DE L'ANALYSE" $(ls -t /home/ubuntu/logs/analyze_notify_*.log | head -1)

================================================================================
üìà CONSULTATION DES R√âSULTATS JSON
================================================================================

# Voir le dernier r√©sultat JSON
cat $(ls -t /home/ubuntu/data/results_*.json | head -1) | jq .

# Voir uniquement l'analyse
cat $(ls -t /home/ubuntu/data/results_*.json | head -1) | jq .details.analysis

# Voir uniquement les notifications
cat $(ls -t /home/ubuntu/data/results_*.json | head -1) | jq .details.notifications

# Voir le statut de coh√©rence
cat $(ls -t /home/ubuntu/data/results_*.json | head -1) | jq .details.analysis.coherence_check

================================================================================
üîç V√âRIFICATION DE LA CONFIGURATION
================================================================================

# V√©rifier les credentials OVH/SMTP
cat /home/ubuntu/.api_secret_infos/api_secrets.json | jq .

# V√©rifier la configuration Linxo
cat /home/ubuntu/linxo_agent/config_linxo.json | jq .

# V√©rifier les d√©penses r√©currentes
cat /home/ubuntu/linxo_agent/depenses_recurrentes.json | jq .

================================================================================
üßπ NETTOYAGE
================================================================================

# Supprimer les logs de plus de 30 jours
find /home/ubuntu/logs -name "analyze_notify_*.log" -mtime +30 -delete

# Supprimer les r√©sultats JSON de plus de 30 jours
find /home/ubuntu/data -name "results_*.json" -mtime +30 -delete

# Lister les fichiers volumineux
du -sh /home/ubuntu/logs/* | sort -h | tail -10
du -sh /home/ubuntu/data/* | sort -h | tail -10

================================================================================
üìö DOCUMENTATION
================================================================================

# Lire la synth√®se d'impl√©mentation
cat /home/ubuntu/linxo_agent/SYNTHESE_IMPLEMENTATION.md | less

# Lire le rapport de validation
cat /home/ubuntu/linxo_agent/RAPPORT_VALIDATION_CSV.md | less

# Lire le guide d'utilisation
cat /home/ubuntu/linxo_agent/GUIDE_UTILISATION_VALIDATION.md | less

# Lire le r√©sum√© rapide
cat /home/ubuntu/linxo_agent/README_VALIDATION.md | less

# Ouvrir les PDFs (si disponibles)
ls -lh /home/ubuntu/linxo_agent/*.pdf

================================================================================
üîß D√âPANNAGE
================================================================================

# V√©rifier que Python est install√©
python3 --version

# V√©rifier les d√©pendances Python
pip3 list | grep -E "pandas|requests"

# Tester la connexion SMTP
python3 -c "import smtplib; print('SMTP OK')"

# V√©rifier les permissions des fichiers
ls -la /home/ubuntu/linxo_agent/*.py
ls -la /home/ubuntu/data/

# Rendre les scripts ex√©cutables
chmod +x /home/ubuntu/linxo_agent/*.py
chmod +x /home/ubuntu/linxo_agent/*.sh

================================================================================
üìä STATISTIQUES
================================================================================

# Compter les transactions dans le CSV
wc -l /home/ubuntu/data/latest.csv

# Voir les dates min/max dans le CSV
awk -F'\t' 'NR>1 {print $1}' /home/ubuntu/data/latest.csv | sort | head -1
awk -F'\t' 'NR>1 {print $1}' /home/ubuntu/data/latest.csv | sort | tail -1

# Compter les transactions par mois
awk -F'\t' 'NR>1 {split($1,a,"/"); print a[2]"/"a[3]}' /home/ubuntu/data/latest.csv | sort | uniq -c

# Voir les cat√©gories de d√©penses
awk -F'\t' 'NR>1 {print $3}' /home/ubuntu/data/latest.csv | sort | uniq -c | sort -rn | head -10

================================================================================
üîÑ WORKFLOW COMPLET
================================================================================

# 1. T√©l√©charger le CSV depuis Linxo (mois en cours uniquement)
# 2. Copier le fichier
cp ~/Downloads/linxo_export.csv /home/ubuntu/data/latest.csv

# 3. V√©rifier le fichier
head -20 /home/ubuntu/data/latest.csv
wc -l /home/ubuntu/data/latest.csv

# 4. Test dry-run
cd /home/ubuntu/linxo_agent
python3 analyze_and_notify_v2_FIXED.py --period current_month --dry-run

# 5. Si OK, lancer l'analyse r√©elle
python3 analyze_and_notify_v2_FIXED.py --period current_month

# 6. V√©rifier les logs
tail -100 $(ls -t /home/ubuntu/logs/analyze_notify_*.log | head -1)

# 7. V√©rifier les r√©sultats
cat $(ls -t /home/ubuntu/data/results_*.json | head -1) | jq .

================================================================================
üìû CONTACTS
================================================================================

SMS: +33626267421, +33611435899
Email: phiperez@gmail.com, caliemphi@gmail.com

================================================================================
‚úÖ AIDE RAPIDE
================================================================================

Probl√®me: "CSV_VALIDATION_FAILED"
Solution: T√©l√©charger un nouveau CSV avec uniquement le mois en cours

Probl√®me: "No such file or directory"
Solution: V√©rifier que /home/ubuntu/data/latest.csv existe

Probl√®me: SMS/Email non envoy√©s
Solution: V√©rifier /home/ubuntu/.api_secret_infos/api_secrets.json

================================================================================
